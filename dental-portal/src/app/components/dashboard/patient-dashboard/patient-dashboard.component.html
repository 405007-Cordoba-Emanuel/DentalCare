<div class="min-h-screen bg-gray-50">
  <div class="flex min-h-[calc(100vh-64px)]">
    <!-- Contenido Principal -->
    <div class="flex-1 bg-gray-50 p-6 overflow-y-auto min-w-0">
      <!-- Loading State -->
      @if (isLoading) {
        <div class="flex justify-center items-center min-h-[400px]">
          <mat-spinner diameter="60"></mat-spinner>
        </div>
      }
      
      <!-- Error State -->
      @if (!isLoading && errorMessage) {
        <mat-card class="bg-white rounded-2xl border border-red-200 mb-6 shadow-md">
          <mat-card-content class="p-6">
            <div class="flex items-center gap-3 text-red-600">
              <mat-icon>error</mat-icon>
              <p class="m-0">{{ errorMessage }}</p>
            </div>
          </mat-card-content>
        </mat-card>
      }
      
      <!-- Content -->
      @if (!isLoading && !errorMessage) {

      <!-- Estadísticas y Contenido -->
      <div class="grid grid-cols-1 lg:grid-cols-[repeat(auto-fit,minmax(350px,1fr))] gap-6 mb-8">
        <!-- Próxima Cita -->
        <mat-card class="bg-white rounded-2xl border border-slate-200 overflow-hidden">
          <mat-card-header class="p-5 pb-0">
            <mat-card-title>Próxima Cita</mat-card-title>
          </mat-card-header>
          
          <mat-card-content class="p-5">
            <div class="text-center">
              @if (upcomingAppointments.length > 0) {
                @let appointment = upcomingAppointments[0];
                <div class="flex flex-col items-center bg-gradient-to-br from-blue-600 to-blue-700 text-white p-5 rounded-2xl mb-5">
                  <span class="text-4xl font-bold leading-none">{{ formatDay(appointment.date) }}</span>
                  <span class="text-base font-medium uppercase mt-1">{{ formatMonth(appointment.date) }}</span>
                </div>
                
                <div>
                  <h3 class="text-xl font-semibold text-slate-800 m-0 mb-3 break-words">{{ appointment.type }}</h3>
                  <p class="flex items-center justify-center gap-2 text-slate-500 m-0 mb-2 text-sm break-words">
                    <mat-icon>access_time</mat-icon>
                    {{ appointment.time }}
                  </p>
                  <p class="flex items-center justify-center gap-2 text-slate-500 m-0 mb-2 text-sm break-words">
                    <mat-icon>medical_services</mat-icon>
                    {{ appointment.dentist }}
                  </p>
                </div>
                
                <button 
                  mat-raised-button 
                  color="primary"
                  class="mt-4 w-full whitespace-nowrap bg-blue-600 hover:bg-blue-700"
                  (click)="scheduleAppointment()"
                >
                  <mat-icon>edit_calendar</mat-icon>
                  Reagendar
                </button>
              } @else {
                <div class="flex flex-col items-center gap-3 py-8">
                  <mat-icon class="text-slate-400 text-5xl">calendar_today</mat-icon>
                  <p class="text-slate-500 m-0">No hay citas programadas</p>
                </div>
              }
            </div>
          </mat-card-content>
        </mat-card>

        <!-- Mensajes Recientes -->
        <mat-card class="bg-white rounded-2xl border border-slate-200 overflow-hidden">
          <mat-card-header class="p-5 pb-0">
            <mat-card-title class="flex items-center">
              <mat-icon class="mr-3 text-blue-600 flex-shrink-0">message</mat-icon>
              Mensajes Recientes
            </mat-card-title>
          </mat-card-header>
          
          <mat-card-content class="p-5">
            <div class="flex flex-col gap-4 mb-5">
              @for (message of recentMessages; track message.from) {
              <div 
                class="flex items-start gap-3 p-3 rounded-lg transition-all duration-300 overflow-hidden"
                [class.bg-blue-50]="message.unread"
                [class.border-l-4]="message.unread" [class.border-blue-600]="message.unread" [class.bg-gray-50]="!message.unread" [class.hover:bg-slate-100]="!message.unread">
                <div class="w-10 h-10 bg-gradient-to-br from-blue-50 to-blue-100 rounded-full flex items-center justify-center flex-shrink-0">
                  <mat-icon class="text-blue-600 text-xl w-5 h-5">{{ message.from === 'Sistema' ? 'notifications' : 'medical_services' }}</mat-icon>
                </div>
                <div class="flex-1 min-w-0">
                  <div class="flex justify-between items-center mb-1 flex-wrap gap-2">
                    <h4 class="text-sm font-semibold text-slate-800 m-0 break-words">{{ message.from }}</h4>
                    <span class="text-slate-400 text-xs whitespace-nowrap">{{ message.time }}</span>
                  </div>
                  <p class="text-slate-500 m-0 text-sm leading-relaxed break-words">{{ message.message }}</p>
                </div>
                
                @if (message.unread) {
                  <div class="flex-shrink-0 mt-2">
                    <div class="w-2 h-2 bg-blue-600 rounded-full"></div>
                  </div>
                }
              </div>
            }
            </div>
            
            <button 
              mat-stroked-button 
              color="primary"
              class="w-full justify-center whitespace-nowrap"
              (click)="sendMessage()"
            >
              <mat-icon>send</mat-icon>
              Enviar Mensaje
            </button>
          </mat-card-content>
        </mat-card>
      </div>

      <!-- Contenido de Listas -->
      <div class="grid grid-cols-1 lg:grid-cols-[repeat(auto-fit,minmax(400px,1fr))] gap-6">
        <!-- Citas Próximas -->
        <mat-card class="bg-white rounded-2xl border border-slate-200 overflow-hidden">
          <mat-card-header class="p-6 pb-0">
            <mat-card-title class="flex items-center">
              <mat-icon class="mr-3 text-blue-600 flex-shrink-0">schedule</mat-icon>
              Próximas Citas
            </mat-card-title>
          </mat-card-header>
          
          <mat-card-content class="p-6">
            <div class="flex flex-col gap-4">
              @for (appointment of upcomingAppointments; track appointment.id) {
              <div 
                class="flex items-center gap-5 p-5 bg-gray-50 rounded-xl transition-all duration-300 overflow-hidden flex-wrap hover:bg-slate-100 hover:translate-x-1"
              >
                <div class="flex-shrink-0">
                  <div class="flex flex-col items-center bg-gradient-to-br from-blue-600 to-blue-700 text-white p-3 rounded-xl min-w-[60px]">
                    <span class="text-2xl font-bold leading-none">{{ formatDay(appointment.date) }}</span>
                    <span class="text-xs font-medium uppercase mt-1">{{ formatMonth(appointment.date) }}</span>
                  </div>
                </div>
                
                <div class="flex-1 min-w-0">
                  <h4 class="text-lg font-semibold text-slate-800 m-0 mb-2 break-words">{{ appointment.type }}</h4>
                  <p class="flex items-center gap-2 text-slate-500 m-0 mb-1 text-sm break-words">
                    <mat-icon class="text-base w-4 h-4 text-blue-600 flex-shrink-0">access_time</mat-icon>
                    {{ appointment.time }}
                  </p>
                  <p class="flex items-center gap-2 text-slate-500 m-0 text-sm break-words">
                    <mat-icon class="text-base w-4 h-4 text-blue-600 flex-shrink-0">medical_services</mat-icon>
                    {{ appointment.dentist }}
                  </p>
                </div>
                
                <div class="flex-shrink-0">
                  <app-badge 
                    [text]="appointment.status"
                    [variant]="getBadgeVariant(appointment.status)"
                  ></app-badge>
                </div>
              </div>
            }
            </div>
          </mat-card-content>
        </mat-card>

        <!-- Historial de Tratamientos -->
        <mat-card class="bg-white rounded-2xl border border-slate-200 overflow-hidden">
          <mat-card-header class="p-6 pb-0">
            <mat-card-title class="flex items-center">
              <mat-icon class="mr-3 text-blue-600 flex-shrink-0">history</mat-icon>
              Historial de Tratamientos
            </mat-card-title>
          </mat-card-header>
          
          <mat-card-content class="p-6">
            <div class="flex flex-col gap-3">
              @for (treatment of treatmentHistory; track treatment.id) {
              <div 
                class="group flex items-center gap-4 p-4 bg-gray-50 rounded-xl cursor-pointer transition-all duration-300 overflow-hidden flex-wrap hover:bg-slate-100 hover:translate-x-1"
                (click)="viewTreatmentDetails(treatment.id)"
              >
                <div class="flex-shrink-0 min-w-[60px]">
                  <span class="text-slate-500 text-sm font-medium whitespace-nowrap">{{ formatShortDate(treatment.date) }}</span>
                </div>
                
                <div class="flex-1 min-w-[150px]">
                  <h4 class="text-base font-semibold text-slate-800 m-0 mb-1 break-words">{{ treatment.procedure }}</h4>
                  <p class="text-slate-500 m-0 text-sm break-words">{{ treatment.dentist }}</p>
                </div>
                
                <div class="flex-shrink-0 min-w-[60px] text-center">
                  <span class="text-lg font-semibold text-blue-600 whitespace-nowrap">${{ treatment.cost }}</span>
                </div>
                
                <div class="flex-shrink-0 min-w-[80px] max-w-[120px]">
                  <app-badge 
                    [text]="treatment.status"
                    [variant]="getBadgeVariant(treatment.status)"
                  ></app-badge>
                </div>
                
                <mat-icon class="text-slate-300 transition-all duration-300 flex-shrink-0 ml-auto group-hover:text-blue-600 group-hover:translate-x-1">chevron_right</mat-icon>
              </div>
            }
            </div>
          </mat-card-content>
        </mat-card>
      </div>
      }
    </div>
  </div>
</div>
