<div class="min-h-screen bg-gray-50">
  <div class="flex min-h-[calc(100vh-64px)]">
    <!-- Contenido Principal -->
    <div class="flex-1 bg-gray-50 p-6 overflow-y-auto min-w-0">
      <!-- Loading State -->
      @if (isLoading) {
        <div class="flex justify-center items-center min-h-[400px]">
          <mat-spinner diameter="60"></mat-spinner>
        </div>
      }
      
      <!-- Error State -->
      @if (!isLoading && errorMessage) {
        <mat-card class="bg-white rounded-2xl border border-red-200 mb-6 shadow-md">
          <mat-card-content class="p-6">
            <div class="flex items-center gap-3 text-red-600">
              <mat-icon>error</mat-icon>
              <p class="m-0">{{ errorMessage }}</p>
            </div>
          </mat-card-content>
        </mat-card>
      }
      
      <!-- Content -->
      @if (!isLoading && !errorMessage) {

      <!-- Próxima Cita - Ancho Completo -->
      <div class="mb-6">
        <mat-card class="bg-white rounded-2xl border border-slate-200 overflow-hidden">
          <mat-card-header class="p-5 pb-0">
            <mat-card-title>Próxima Cita</mat-card-title>
          </mat-card-header>
          
          <mat-card-content class="p-5">
            <div class="text-center">
              @if (upcomingAppointments.length > 0) {
                @let appointment = upcomingAppointments[0];
                <div class="flex flex-col items-center bg-gradient-to-br from-blue-600 to-blue-700 text-white p-5 rounded-2xl mb-5">
                  <span class="text-4xl font-bold leading-none">{{ formatDay(appointment.date) }}</span>
                  <span class="text-base font-medium uppercase mt-1">{{ formatMonth(appointment.date) }}</span>
                </div>
                
                <div>
                  <h3 class="text-xl font-semibold text-slate-800 m-0 mb-3 break-words">{{ appointment.type }}</h3>
                  <p class="flex items-center justify-center gap-2 text-slate-500 m-0 mb-2 text-sm break-words">
                    <mat-icon>access_time</mat-icon>
                    {{ appointment.time }}
                  </p>
                  <p class="flex items-center justify-center gap-2 text-slate-500 m-0 mb-2 text-sm break-words">
                    <mat-icon>medical_services</mat-icon>
                    {{ appointment.dentist }}
                  </p>
                </div>
              } @else {
                <div class="flex flex-col items-center gap-3 py-8">
                  <mat-icon class="text-slate-400 text-5xl">calendar_today</mat-icon>
                  <p class="text-slate-500 m-0">No hay citas programadas</p>
                </div>
              }
            </div>
          </mat-card-content>
        </mat-card>
      </div>

      <!-- Tratamiento en Curso - Ancho Completo -->
      <div class="mb-6">
        <mat-card 
          class="bg-white rounded-2xl border border-slate-200 overflow-hidden hover:shadow-lg transition-shadow duration-300 cursor-pointer group"
          (click)="navigateToTreatments()"
        >
          <div class="p-5 pb-3 border-b border-slate-100 flex items-center justify-between">
            <div class="flex items-center gap-3">
              <mat-icon class="text-blue-600">healing</mat-icon>
              <span class="text-lg font-semibold text-slate-800">Tratamiento en Curso</span>
            </div>
            <mat-icon class="text-slate-300 group-hover:text-blue-600 group-hover:translate-x-1 transition-all duration-300">chevron_right</mat-icon>
          </div>
          
          <mat-card-content class="p-5">
            @if (currentTreatment) {
              <div class="flex flex-col gap-4">
                <div>
                  <h3 class="text-xl font-semibold text-slate-800 m-0 mb-2 break-words">{{ currentTreatment.name }}</h3>
                  <p class="text-slate-500 m-0 text-sm break-words">{{ currentTreatment.description || 'Sin descripción' }}</p>
                </div>
                
                <div>
                  <div class="flex justify-between items-center mb-2">
                    <span class="text-sm font-medium text-slate-600">Progreso</span>
                    <span class="text-sm font-semibold text-blue-600">{{ currentTreatment.progressPercentage || 0 }}%</span>
                  </div>
                  <mat-progress-bar 
                    mode="determinate" 
                    [value]="currentTreatment.progressPercentage || 0"
                    [color]="getProgressColor(currentTreatment.progressPercentage || 0)"
                    class="h-3 rounded-full"
                  ></mat-progress-bar>
                  <div class="flex justify-between items-center mt-2 text-xs text-slate-500">
                    <span>{{ currentTreatment.completedSessions || 0 }} de {{ currentTreatment.totalSessions || 0 }} sesiones</span>
                    <span>{{ getTreatmentStatusLabel(currentTreatment.status) }}</span>
                  </div>
                </div>
              </div>
            } @else {
              <div class="flex flex-col items-center gap-3 py-8">
                <mat-icon class="text-slate-400 text-5xl">medical_services</mat-icon>
                <p class="text-slate-500 m-0">No hay tratamientos en curso</p>
              </div>
            }
          </mat-card-content>
        </mat-card>
      </div>

      <!-- Cards de Información Rápida -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
        <!-- Mensajes No Leídos -->
        <mat-card 
          class="bg-white rounded-2xl border border-slate-200 overflow-hidden hover:shadow-lg transition-shadow duration-300 cursor-pointer group"
          (click)="navigateToMessages()"
        >
          <div class="p-5 pb-3 border-b border-slate-100 flex items-center justify-between">
            <div class="flex items-center gap-3">
              <mat-icon class="text-blue-600">message</mat-icon>
              <span class="text-lg font-semibold text-slate-800">Mensajes</span>
            </div>
            <mat-icon class="text-slate-300 group-hover:text-blue-600 group-hover:translate-x-1 transition-all duration-300">chevron_right</mat-icon>
          </div>
          
          <mat-card-content class="p-5">
            <div class="text-center">
              <div class="flex flex-col items-center bg-gradient-to-br from-blue-600 to-blue-700 text-white p-6 rounded-2xl mb-3">
                <span class="text-5xl font-bold leading-none">{{ unreadMessagesCount }}</span>
                <span class="text-sm font-medium uppercase mt-2 opacity-90">{{ unreadMessagesCount === 1 ? 'Sin Leer' : 'Sin Leer' }}</span>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <!-- Recetas Recientes -->
        <mat-card 
          class="bg-white rounded-2xl border border-slate-200 overflow-hidden hover:shadow-lg transition-shadow duration-300 cursor-pointer group"
          (click)="navigateToPrescriptions()"
        >
          <div class="p-5 pb-3 border-b border-slate-100 flex items-center justify-between">
            <div class="flex items-center gap-3">
              <mat-icon class="text-blue-600">description</mat-icon>
              <span class="text-lg font-semibold text-slate-800">Mis Recetas</span>
            </div>
            <mat-icon class="text-slate-300 group-hover:text-blue-600 group-hover:translate-x-1 transition-all duration-300">chevron_right</mat-icon>
          </div>
          
          <mat-card-content class="p-5">
            <div class="text-center">
              <div class="flex flex-col items-center bg-gradient-to-br from-green-600 to-green-700 text-white p-5 rounded-2xl mb-3">
                <mat-icon class="text-4xl mb-2">receipt_long</mat-icon>
                <span class="text-sm font-medium uppercase opacity-90">Recetas Médicas</span>
              </div>
              <p class="text-slate-600 m-0 text-sm">Accede a tu historial completo de recetas</p>
            </div>
          </mat-card-content>
        </mat-card>
      </div>

      }
    </div>
  </div>
</div>
