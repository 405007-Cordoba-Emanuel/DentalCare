<div class="flex flex-col w-full max-h-[90vh] overflow-hidden rounded-2xl">
  <!-- Header con gradiente mejorado -->
  <div
    class="flex justify-between items-start px-6 py-5 bg-gradient-to-br from-blue-600 via-blue-700 to-indigo-700 text-white rounded-t-2xl shadow-lg flex-shrink-0"
  >
    <div class="flex gap-4 items-center">
      <div class="bg-white/20 backdrop-blur-sm p-3 rounded-xl">
        <mat-icon class="!text-3xl !w-8 !h-8">event_available</mat-icon>
      </div>
      <div>
        <h2 class="text-2xl font-bold m-0">Detalles de la Cita</h2>
      </div>
    </div>
    <button
      mat-icon-button
      (click)="onClose()"
      class="!text-white hover:bg-white/10 !transition-all"
    >
      <mat-icon>close</mat-icon>
    </button>
  </div>
  <!-- Contenido con scroll -->
  <div class="flex-1 overflow-y-auto">
    <!-- Información del Paciente/Dentista con diseño mejorado -->
    <div class="px-6 pt-4">
      <div
        class="relative flex gap-4 p-4 bg-gradient-to-br from-gray-50 to-blue-50 rounded-xl border border-gray-200 shadow-sm hover:shadow-md transition-shadow duration-300"
      >
        <!-- Badge en la esquina superior derecha -->
        <div
          class="absolute top-2 right-2 inline-flex items-center gap-1 px-2 py-1 rounded-full font-semibold text-sm"
          [ngClass]="{
            'bg-blue-100 text-blue-800 border border-blue-200':
              getStatusColor(appointment.status) === 'blue',
            'bg-green-100 text-green-800 border border-green-200':
              getStatusColor(appointment.status) === 'green',
            'bg-gray-100 text-gray-700 border border-gray-200':
              getStatusColor(appointment.status) === 'gray',
            'bg-amber-100 text-amber-800 border border-amber-200':
              getStatusColor(appointment.status) === 'amber',
            'bg-red-100 text-red-800 border border-red-200':
              getStatusColor(appointment.status) === 'red'
          }"
        >
          <mat-icon class="!text-sm !w-4 !h-4">
            {{
              appointment.status === "COMPLETADO"
                ? "check_circle"
                : appointment.status === "CANCELADO"
                ? "cancel"
                : appointment.status === "CONFIRMADO"
                ? "verified"
                : "schedule"
            }}
          </mat-icon>
          <span>{{ getStatusLabel(appointment.status) }}</span>
        </div>

        <!-- Contenido principal -->
        <div class="bg-blue-500 text-white p-3 rounded-lg shadow-md self-start">
          <mat-icon class="!text-3xl !w-8 !h-8">person</mat-icon>
        </div>
        <div class="flex-1 pr-24">
          <p
            class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-1"
          >
            {{ userRole === "DENTIST" ? "Paciente" : "Dentista" }}
          </p>
          <p class="text-lg font-bold text-gray-900 mb-1">
            {{
              userRole === "DENTIST"
                ? appointment.patientName
                : appointment.dentistName
            }}
          </p>
          <p
            *ngIf="userRole === 'DENTIST'"
            class="text-sm text-gray-600 flex items-center gap-1"
          >
            <mat-icon class="!text-base !w-4 !h-4">badge</mat-icon>
            DNI: {{ appointment.patientDni }}
          </p>
          <p
            *ngIf="userRole === 'PATIENT' && appointment.dentistSpecialty"
            class="text-sm text-blue-600 font-medium flex items-center gap-1"
          >
            <mat-icon class="!text-base !w-4 !h-4">medical_services</mat-icon>
            {{ appointment.dentistSpecialty }}
          </p>
        </div>
      </div>
    </div>

    <!-- Formulario Genérico -->
    <div class="px-6 pt-4 pb-4 mx-2">
      <app-generic-form
        [fields]="formFields"
        [initialData]="initialFormData"
        [readonly]="!isEditing"
        [loading]="isSaving"
        [submitText]="'Guardar Cambios'"
        (formSubmit)="onFormSubmit($event)"
      ></app-generic-form>
    </div>

    <!-- Metadata con diseño mejorado -->
    <div
      *ngIf="appointment.createdDatetime"
      class="flex flex-col gap-2 px-6 py-4 bg-gradient-to-r from-gray-50 to-gray-100 border-t border-b border-gray-200"
    >
      <div class="flex items-center gap-2 text-sm text-gray-600">
        <div class="bg-blue-100 p-1.5 rounded-lg">
          <mat-icon class="!text-base !w-4 !h-4 text-blue-600"
            >schedule</mat-icon
          >
        </div>
        <span class="font-medium">Creado:</span>
        <span class="text-gray-800">{{
          appointment.createdDatetime | date : "dd/MM/yyyy HH:mm"
        }}</span>
      </div>
      <div
        *ngIf="appointment.lastUpdatedDatetime"
        class="flex items-center gap-2 text-sm text-gray-600"
      >
        <div class="bg-green-100 p-1.5 rounded-lg">
          <mat-icon class="!text-base !w-4 !h-4 text-green-600"
            >update</mat-icon
          >
        </div>
        <span class="font-medium">Actualizado:</span>
        <span class="text-gray-800">{{
          appointment.lastUpdatedDatetime | date : "dd/MM/yyyy HH:mm"
        }}</span>
      </div>
    </div>
  </div>

  <!-- Actions con diseño mejorado (Footer fijo) -->
  <div
    class="flex justify-between items-center px-6 py-4 bg-gray-50 border-t border-gray-200 rounded-b-2xl gap-4 flex-shrink-0"
  >
    <div class="flex gap-3 items-center">
      <button
        *ngIf="!isEditing"
        mat-button
        (click)="onClose()"
        class="!text-gray-600 hover:!bg-gray-100"
      >
        Cerrar
      </button>

      <button
        *ngIf="
          userRole === 'DENTIST' &&
          !isEditing &&
          appointment.status !== 'CANCELADO'
        "
        mat-raised-button
        color="primary"
        (click)="toggleEdit()"
      >
        <mat-icon>edit</mat-icon>
        Editar
      </button>

      <button
        *ngIf="isEditing"
        mat-button
        (click)="toggleEdit()"
        [disabled]="isSaving"
        class="!text-gray-600 hover:!bg-gray-100 disabled:!text-gray-400"
      >
        <mat-icon>close</mat-icon>
        Cancelar
      </button>
    </div>
  </div>
</div>
