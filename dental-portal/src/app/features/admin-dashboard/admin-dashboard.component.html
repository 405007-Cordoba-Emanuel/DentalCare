<div class="admin-dashboard-container">
  <div class="header-section">
    <div class="title-section">
      <h1 class="main-title">Panel de Administración</h1>
      <p class="subtitle">Gestiona usuarios y crea nuevas altas de dentistas</p>
    </div>
  </div>

  <mat-tab-group [(selectedIndex)]="selectedTabIndex" class="dashboard-tabs">
    <!-- Tab: Lista de Usuarios -->
    <mat-tab label="Usuarios del Sistema">
      <div class="tab-content">
        <!-- Búsqueda -->
        <div class="search-section">
          <mat-form-field appearance="fill" class="search-field">
            <mat-icon matPrefix>search</mat-icon>
            <input 
              matInput 
              [(ngModel)]="searchTerm" 
              (input)="onSearchChange()" 
              placeholder="Buscar por nombre, email o rol..." 
            />
          </mat-form-field>
        </div>

        <!-- Loading State -->
        <div *ngIf="isLoading" class="loading-container">
          <mat-spinner diameter="50"></mat-spinner>
          <p>Cargando usuarios...</p>
        </div>

        <!-- Tabla de Usuarios -->
        <div *ngIf="!isLoading" class="table-container">
          <table mat-table [dataSource]="filteredUsers" class="users-table">
            <!-- ID Column -->
            <ng-container matColumnDef="id">
              <th mat-header-cell *matHeaderCellDef>ID</th>
              <td mat-cell *matCellDef="let user">{{ user.id }}</td>
            </ng-container>

            <!-- Name Column -->
            <ng-container matColumnDef="name">
              <th mat-header-cell *matHeaderCellDef>Nombre</th>
              <td mat-cell *matCellDef="let user">
                <div class="user-name-cell">
                  <div class="user-avatar">
                    {{ user.firstName.charAt(0) }}{{ user.lastName.charAt(0) }}
                  </div>
                  <div class="user-info">
                    <div class="user-name">{{ getFullName(user) }}</div>
                    <div class="user-email">{{ user.email }}</div>
                  </div>
                </div>
              </td>
            </ng-container>

            <!-- Email Column -->
            <ng-container matColumnDef="email">
              <th mat-header-cell *matHeaderCellDef>Email</th>
              <td mat-cell *matCellDef="let user">{{ user.email }}</td>
            </ng-container>

            <!-- Role Column -->
            <ng-container matColumnDef="role">
              <th mat-header-cell *matHeaderCellDef>Rol</th>
              <td mat-cell *matCellDef="let user">
                <span class="role-badge" [class]="'role-' + user.role.toLowerCase()">
                  {{ getRoleLabel(user.role) }}
                </span>
              </td>
            </ng-container>

            <!-- Is Active Column -->
            <ng-container matColumnDef="isActive">
              <th mat-header-cell *matHeaderCellDef>Estado</th>
              <td mat-cell *matCellDef="let user">
                <span class="status-badge" [class.active]="user.isActive" [class.inactive]="!user.isActive">
                  {{ user.isActive ? 'Activo' : 'Inactivo' }}
                </span>
              </td>
            </ng-container>

            <!-- Last Login Column -->
            <ng-container matColumnDef="lastLogin">
              <th mat-header-cell *matHeaderCellDef>Último Acceso</th>
              <td mat-cell *matCellDef="let user">{{ formatDate(user.lastLogin) }}</td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
          </table>

          <!-- Empty State -->
          <div *ngIf="filteredUsers.length === 0" class="empty-state">
            <mat-icon>people_outline</mat-icon>
            <h3>No se encontraron usuarios</h3>
            <p>{{ searchTerm ? 'Intenta con otro término de búsqueda' : 'No hay usuarios registrados en el sistema' }}</p>
          </div>
        </div>
      </div>
    </mat-tab>

    <!-- Tab: Crear Dentista -->
    <mat-tab label="Crear Alta de Dentista">
      <div class="tab-content">
        <mat-card class="create-dentist-card">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>person_add</mat-icon>
              Nueva Alta de Dentista
            </mat-card-title>
            <mat-card-subtitle>
              Selecciona un usuario existente y completa los datos profesionales
            </mat-card-subtitle>
          </mat-card-header>

          <mat-card-content>
            <form [formGroup]="createDentistForm" (ngSubmit)="onCreateDentistSubmit()" class="create-dentist-form">
              <!-- Usuario -->
              <mat-form-field appearance="fill" class="full-width">
                <mat-label>Usuario</mat-label>
                <mat-select formControlName="userId" required>
                  <mat-option value="">Seleccionar usuario</mat-option>
                  <mat-option *ngFor="let user of availableUsers" [value]="user.id">
                    {{ getUserDisplayName(user) }}
                  </mat-option>
                </mat-select>
                <mat-error *ngIf="createDentistForm.get('userId')?.hasError('required')">
                  Debes seleccionar un usuario
                </mat-error>
              </mat-form-field>

              <!-- Número de Matrícula -->
              <mat-form-field appearance="fill" class="full-width">
                <mat-label>Número de Matrícula</mat-label>
                <input 
                  matInput 
                  formControlName="licenseNumber" 
                  placeholder="Ej: DENT-12345"
                  maxlength="20"
                />
                <mat-hint>Máximo 20 caracteres, solo letras, números y guiones</mat-hint>
                <mat-error *ngIf="createDentistForm.get('licenseNumber')?.hasError('required')">
                  El número de matrícula es requerido
                </mat-error>
                <mat-error *ngIf="createDentistForm.get('licenseNumber')?.hasError('pattern')">
                  Solo se permiten letras, números y guiones
                </mat-error>
                <mat-error *ngIf="createDentistForm.get('licenseNumber')?.hasError('maxlength')">
                  Máximo 20 caracteres
                </mat-error>
              </mat-form-field>

              <!-- Especialidad -->
              <mat-form-field appearance="fill" class="full-width">
                <mat-label>Especialidad</mat-label>
                <input 
                  matInput 
                  formControlName="specialty" 
                  placeholder="Ej: Odontología General"
                  maxlength="150"
                />
                <mat-hint>Máximo 150 caracteres</mat-hint>
                <mat-error *ngIf="createDentistForm.get('specialty')?.hasError('required')">
                  La especialidad es requerida
                </mat-error>
                <mat-error *ngIf="createDentistForm.get('specialty')?.hasError('maxlength')">
                  Máximo 150 caracteres
                </mat-error>
              </mat-form-field>

              <!-- Botones -->
              <div class="form-actions">
                <button 
                  mat-raised-button 
                  color="primary" 
                  type="submit"
                  [disabled]="isCreatingDentist || createDentistForm.invalid"
                  class="submit-button"
                >
                  <mat-icon *ngIf="!isCreatingDentist">save</mat-icon>
                  <mat-spinner *ngIf="isCreatingDentist" diameter="20" class="button-spinner"></mat-spinner>
                  {{ isCreatingDentist ? 'Creando...' : 'Crear Dentista' }}
                </button>
                <button 
                  mat-stroked-button 
                  type="button"
                  (click)="createDentistForm.reset()"
                  [disabled]="isCreatingDentist"
                >
                  Limpiar
                </button>
              </div>
            </form>
          </mat-card-content>
        </mat-card>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>
