<form
  [formGroup]="formGroup"
  (ngSubmit)="onSubmit()"
  class="w-full max-w-5xl mx-auto bg-white p-6 sm:p-8"
>
  <!-- Header con título e icono -->
  @if (formTitle() && formTitle().trim() !== '') {
    <div class="mb-8 border-b border-gray-200 pb-4 flex items-center gap-2">
      <h2 class="text-2xl font-semibold text-gray-900">
        {{ formTitle() }}
      </h2>
    </div>
  }

  <!-- Grid de campos -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-5 mb-8">
    @for (field of fields(); track field.name) {
    <div [class]="field.fullWidth ? 'md:col-span-2' : 'col-span-1'">
      <label class="block text-sm font-medium text-gray-700 mb-1.5">
        {{ field.label }}
        @if (isFieldDisabled(field.name)) {
          <span class="text-xs text-gray-500 ml-1">(No editable)</span>
        }
      </label>

      <!-- MODO LECTURA -->
      @if (readonly()) {
        <div class="w-full px-0 py-2 text-gray-900 border-b-2 border-gray-200">
          {{ getDisplayValue(field.name) }}
        </div>
      }
      
      <!-- MODO EDICIÓN -->
      @else {
        @if (field.type === 'text' || field.type === 'number') {
          <input
            [type]="field.type"
            [formControlName]="field.name"
            [placeholder]="field.placeholder"
            [class.bg-gray-100]="isFieldDisabled(field.name)"
            [class.text-gray-500]="isFieldDisabled(field.name)"
            [class.cursor-not-allowed]="isFieldDisabled(field.name)"
            [class.border-gray-200]="isFieldDisabled(field.name)"
            class="w-full border-0 border-b-2 border-gray-300 bg-transparent px-0 py-2 text-gray-900 placeholder-gray-400 focus:border-blue-600 focus:ring-0 focus:outline-none transition-colors"
          />
        } 
        @if (field.type === 'textarea') {
          <textarea
            [formControlName]="field.name"
            [placeholder]="field.placeholder"
            rows="4"
            [class.bg-gray-100]="isFieldDisabled(field.name)"
            [class.text-gray-500]="isFieldDisabled(field.name)"
            [class.cursor-not-allowed]="isFieldDisabled(field.name)"
            [class.border-gray-200]="isFieldDisabled(field.name)"
            class="w-full border border-gray-300 bg-transparent rounded px-3 py-2 text-gray-900 placeholder-gray-400 focus:border-blue-600 focus:ring-1 focus:ring-blue-600 focus:outline-none transition-colors resize-none"
          ></textarea>
        } 
        @if (field.type === 'select') {
          <select
            [formControlName]="field.name"
            [class.bg-gray-100]="isFieldDisabled(field.name)"
            [class.text-gray-500]="isFieldDisabled(field.name)"
            [class.cursor-not-allowed]="isFieldDisabled(field.name)"
            [class.border-gray-200]="isFieldDisabled(field.name)"
            class="w-full border-0 border-b-2 border-gray-300 bg-transparent px-0 py-2 text-gray-900 focus:border-blue-600 focus:ring-0 focus:outline-none transition-colors"
          >
            <option value="" disabled selected>Seleccionar...</option>
            @for (opt of field.options; track opt.value) {
              <option [value]="opt.value">{{ opt.label }}</option>
            }
          </select>
        } 
        @if (field.type === 'date') {
          <input
            type="date"
            [formControlName]="field.name"
            [class.bg-gray-100]="isFieldDisabled(field.name)"
            [class.text-gray-500]="isFieldDisabled(field.name)"
            [class.cursor-not-allowed]="isFieldDisabled(field.name)"
            [class.border-gray-200]="isFieldDisabled(field.name)"
            class="w-full border-0 border-b-2 border-gray-300 bg-transparent px-0 py-2 text-gray-900 focus:border-blue-600 focus:ring-0 focus:outline-none transition-colors"
          />
        }
        @if (field.type === 'datetime-local') {
          <input
            type="datetime-local"
            [formControlName]="field.name"
            [class.bg-gray-100]="isFieldDisabled(field.name)"
            [class.text-gray-500]="isFieldDisabled(field.name)"
            [class.cursor-not-allowed]="isFieldDisabled(field.name)"
            [class.border-gray-200]="isFieldDisabled(field.name)"
            class="w-full border-0 border-b-2 border-gray-300 bg-transparent px-0 py-2 text-gray-900 focus:border-blue-600 focus:ring-0 focus:outline-none transition-colors"
          />
        }

        <!-- Mensaje de error si el campo es inválido y fue tocado -->
        @if (formGroup.get(field.name)?.invalid && formGroup.get(field.name)?.touched && !readonly()) {
          <p class="mt-1 text-xs text-red-600">Este campo es requerido</p>
        }
      }
    </div>
    }
  </div>

  <!-- Botón de submit (solo en modo edición) -->
  @if (!readonly()) {
    <div class="flex justify-end pt-4 border-t border-gray-200">
      <button
        type="submit"
        class="px-6 py-2.5 bg-blue-600 text-white font-medium rounded hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
        [disabled]="formGroup.invalid"
      >
        {{ submitText() }}
      </button>
    </div>
  }
</form>